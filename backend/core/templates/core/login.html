{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Amazon Sign-In</title>
<link rel="stylesheet" href="{% static 'core/css/auth.css' %}" />
</head>
<body>

<div class="header">
  <img class="amazon-logo" src="https://upload.wikimedia.org/wikipedia/commons/a/a9/Amazon_logo.svg" alt="Amazon Logo">
  <div style="flex-grow:1"></div>
  <div>Musharaf</div>
</div>

<div class="auth-container">
  <h2>Sign-In</h2>
  <form id="login-form">
    <label for="username">Username</label>
    <input type="text" id="username" placeholder="Username" required />

    <label for="password">Password</label>
    <input type="password" id="password" placeholder="Password" required />

    <button type="submit">Sign-In</button>
  </form>
  <p class="signup-link">New here? <a href="{% url 'core:register' %}">Create an account</a></p>
</div>

<script>
document.getElementById('login-form').addEventListener('submit', async function (e) {
  e.preventDefault();

  const data = {
    username: e.target.username.value,
    password: e.target.password.value,
  };

  const res = await fetch('/login/', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data),
  });

  const result = await res.json();
  if (res.ok) {
    alert(result.message);

    if (result.token) {
      localStorage.setItem('authToken', result.token);
    }

    if (result.role === 'candidate') {
      window.location.href = '/core/profile/';
    } else if (result.role === 'employer') {
      window.location.href = '/employers/dashboard/';
    } else {
      alert('Unknown role.');
    }
  } else {
    alert(result.message || 'Invalid credentials');
  }
});
</script>

</body>
</html>
